{{define "title"}} {{ .stream.Name }} {{end}}
{{define "scripts"}}

{{end}}
{{define "body"}}
    <div class="panel panel-default panel-primary">
        <div class="panel-heading">{{ .stream.Name }} Overview</div>
        <div class="panel-body">
            <table class="table">
                <tr>
                    <th>Parent Device</th>
                    <td><a href="/secure/device/{{ .stream.DeviceId }}">{{ .device.Name }}</a></td>
                </tr>
                <tr>
                    <th>Name</th><td>{{ .stream.Name }}</td>
                </tr>
                <tr>
                    <th>Identifier #</th><td>{{ .stream.StreamId }}</td>
                </tr>
                <tr>
                    <th>Type of Data</th>
                    <td>{{ .stream.Type }}</td>
                </tr>
                <tr>
                    <th>Is the data temporary?</th>
                    <td>{{ .stream.Ephemeral }}</td>
                </tr>
                <tr>
                    <th>Is the stream an output?</th>
                    <td>{{ .stream.Downlink }}</td>
                </tr>
            </table>
        </div>
    </div>


    <div class="panel panel-default">
        <div class="panel-heading">Manually add data</div>
        <div class="panel-body">
            <form id="result-form">
            </form>

            <form id="shadow-form" action="/secure/stream/action/add/streamid/{{ .stream.StreamId }}" method="POST">
                <input id="formdata" type="hidden" name="formdata"></input>
            </form>
        </div>
    </div>

    <!-- Stream specific javascript libraries for jsonform-->

    <script type='text/javascript' src='/static/js/underscore.js'></script>
    <script type='text/javascript' src='/static/js/jsv.js'></script>
    <script type='text/javascript' src='/static/js/jsonform.js'></script>

    <script type="text/javascript">
    $(document).ready(function(){
        // We get the schama for this stream, but it may not be ready to be
        // parsed by jsonForm, since jsonForm doesn't fully follow the
        // jsonschema specification.
        var schema = JSON.parse({{ .stream.Type }})
        console.log(schema)

        // Did we have to wrap the schema to get it to play nicely with jsonform?
        var schemaIsWrapped = false;
        if(schema["type"] !== "object") {
            schemaIsWrapped = true;
            var tmp = {
                "type":"object",
                "properties": {
                    "value":schema
                }
            }

            // wrap the schema
            schema = tmp
        }

        $('#result-form').jsonForm({
          schema:  schema,
          onSubmit: function (errors, values) {
            if (errors) {
              alert('There is a problem with your input.');
              console.log(errors);
              return false;
            }

            if(schemaIsWrapped) {
                $("#formdata").val(JSON.stringify(values["value"]));
            } else {
                $("#formdata").val(JSON.stringify(values));
            }

            alert($("#formdata").val());
            $("#shadow-form").submit();
            return false;
          }
        });
      });
    </script>

{{end}}
{{template "base" . }}
